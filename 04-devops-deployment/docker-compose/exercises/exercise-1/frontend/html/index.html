<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three-Tier App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .healthy { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Three-Tier Application</h1>
    <p>Frontend served by Nginx, API by FastAPI, Database by PostgreSQL.</p>

    <h2>API Status</h2>
    <div id="api-status" class="status loading">Checking...</div>

    <h2>Database Status</h2>
    <div id="db-status" class="status loading">Checking...</div>

    <button onclick="checkStatus()">Refresh Status</button>

    <script>
        async function checkStatus() {
            // Check API health
            const apiStatus = document.getElementById('api-status');
            try {
                const resp = await fetch('/api/health');
                const data = await resp.json();
                apiStatus.className = 'status healthy';
                apiStatus.textContent = `API: ${data.status} (${data.timestamp})`;
            } catch (e) {
                apiStatus.className = 'status error';
                apiStatus.textContent = `API Error: ${e.message}`;
            }

            // Check DB status via API
            const dbStatus = document.getElementById('db-status');
            try {
                const resp = await fetch('/api/db-status');
                const data = await resp.json();
                dbStatus.className = data.status === 'connected' ? 'status healthy' : 'status error';
                dbStatus.textContent = `Database: ${data.status}`;
            } catch (e) {
                dbStatus.className = 'status error';
                dbStatus.textContent = `Database Error: ${e.message}`;
            }
        }

        // Check on load
        checkStatus();
    </script>
</body>
</html>
