# Exercise 3: Create a Custom Vite Plugin

## Objective

Create a Vite plugin that transforms markdown files with frontmatter into React components.

## Requirements

1. Parse markdown files with YAML frontmatter
2. Convert markdown content to HTML
3. Export as a React component with metadata
4. Support syntax highlighting for code blocks
5. Work in both development and production

## Example Input

```markdown
---
title: Getting Started
author: Jane Doe
date: 2024-01-15
tags: [tutorial, beginner]
---

# Getting Started with Vite

Welcome to the **Vite** tutorial!

## Installation

\`\`\`bash
npm create vite@latest
\`\`\`
```

## Expected Output

```typescript
// Auto-generated by vite-plugin-mdx-component

import React from 'react'

export const frontmatter = {
  title: "Getting Started",
  author: "Jane Doe",
  date: "2024-01-15",
  tags: ["tutorial", "beginner"]
}

export default function MarkdownContent() {
  return (
    <article>
      <h1>Getting Started with Vite</h1>
      <p>Welcome to the <strong>Vite</strong> tutorial!</p>
      <h2>Installation</h2>
      <pre><code class="language-bash">npm create vite@latest</code></pre>
    </article>
  )
}
```

## Usage in Application

```typescript
import GettingStarted, { frontmatter } from './getting-started.md'

function DocsPage() {
  return (
    <div>
      <h1>{frontmatter.title}</h1>
      <p>By {frontmatter.author}</p>
      <GettingStarted />
    </div>
  )
}
```

## Starting Point

```typescript
// plugins/vite-plugin-mdx-component.ts
import type { Plugin } from 'vite'

export function mdxComponentPlugin(): Plugin {
  return {
    name: 'vite-plugin-mdx-component',

    // TODO: Implement resolveId if needed

    // TODO: Implement transform hook
    transform(code: string, id: string) {
      if (!id.endsWith('.md')) {
        return null
      }

      // TODO: Parse frontmatter
      // TODO: Convert markdown to HTML
      // TODO: Generate React component code

      return {
        code: '', // Generated code
        map: null,
      }
    },
  }
}
```

## Tasks

### Task 1: Parse Frontmatter

Extract YAML frontmatter from the markdown content. Frontmatter is delimited by `---` at the start of the file.

### Task 2: Convert Markdown to HTML

Convert the remaining markdown content to HTML. You can use a library like `marked` or implement basic conversion.

### Task 3: Generate Component Code

Generate valid TypeScript/React code that exports:
- `frontmatter` object with parsed metadata
- Default export as a React functional component

### Task 4: Handle Code Blocks

Ensure code blocks are properly escaped and preserve language hints for syntax highlighting.

### Task 5: Add HMR Support

Add Hot Module Replacement support so markdown changes update without full reload.

## Hints

1. Use `gray-matter` package for frontmatter parsing
2. Use `marked` for markdown to HTML conversion
3. Escape strings properly when generating code
4. Return proper source maps for better debugging
5. Check `import.meta.hot` for HMR API

## Dependencies

```bash
npm install -D gray-matter marked
```

## Validation

1. Create a test markdown file with frontmatter
2. Import it in your application
3. Verify frontmatter is accessible
4. Verify content renders correctly
5. Test HMR by editing the markdown file

## Bonus Challenges

1. Add TypeScript type definitions for imports
2. Implement table of contents extraction
3. Add syntax highlighting with Shiki
4. Support MDX (JSX in markdown)
5. Add image optimization for markdown images
